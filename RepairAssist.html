<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RepairAssist</title>
  <!-- Updated favicon -->
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --deep-teal: #004D4D;
      --charcoal: #333333;
      --soft-silver: #F2F2F2;
      --burnt-orange: #FF6600;
      --burnt-orange-hover: #E55A00;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
      --shadow: rgba(0, 0, 0, 0.1);
      --border-radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    [data-theme="dark"] {
      --deep-teal: #006666;
      --charcoal: #e0e0e0;
      --soft-silver: #1a1a1a;
      --shadow: rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    body {
      background: 
        url('https://images.unsplash.com/photo-1593642632823-8f785ba67e45?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80%27') center/cover no-repeat fixed,
        linear-gradient(to bottom, rgba(0, 77, 77, 0.9), rgba(0, 60, 60, 0.95));
      color: var(--charcoal);
      line-height: 1.5;
      transition: var(--transition);
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }
    .shell {
      border: 1px solid rgba(0, 77, 77, 0.2);
      border-radius: var(--border-radius);
      background: rgba(242, 242, 242, 0.85);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      backdrop-filter: blur(8px);
      transition: var(--transition);
    }
    [data-theme="dark"] .shell {
      background: rgba(26, 26, 26, 0.85);
      border-color: rgba(0, 102, 102, 0.3);
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 20px 24px;
      border-bottom: 1px solid rgba(0, 77, 77, 0.1);
      background: linear-gradient(180deg, rgba(0, 77, 77, 0.05), transparent);
      transition: var(--transition);
    }
    [data-theme="dark"] .header {
      border-bottom-color: rgba(0, 102, 102, 0.3);
      background: linear-gradient(180deg, rgba(0, 102, 102, 0.1), transparent);
    }
    .title {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -0.5px;
      background: linear-gradient(to right, var(--deep-teal), var(--burnt-orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    /* Updated RepairAssist button */
    .repairassist-button {
      background: var(--deep-teal);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 4px 12px rgba(0, 77, 77, 0.3);
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
    }
    .repairassist-button:hover {
      background: #003737;
      transform: translateY(-2px);
    }
    [data-theme="dark"] .repairassist-button {
      background: var(--deep-teal);
    }
    [data-theme="dark"] .repairassist-button:hover {
      background: #004D4D;
    }
    .theme-toggle {
      background: var(--deep-teal);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: var(--transition);
    }
    .theme-toggle:hover {
      background: #003737;
      transform: translateY(-2px);
    }
    [data-theme="dark"] .theme-toggle {
      background: var(--deep-teal);
    }
    [data-theme="dark"] .theme-toggle:hover {
      background: #004D4D;
    }
    /* Updated Home button styles */
    .home-button {
      background: var(--burnt-orange);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 4px 12px rgba(255, 102, 0, 0.3);
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
    }
    .home-button:hover {
      background: var(--burnt-orange-hover);
      transform: translateY(-2px);
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .row {
      display: grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 20px;
      padding: 20px;
    }
    @media (max-width: 1024px) {
      .row {
        grid-template-columns: 1fr;
      }
    }
    .pane {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(0, 77, 77, 0.2);
      border-radius: var(--border-radius);
      padding: 18px;
      position: relative;
      overflow: hidden;
      transition: var(--transition);
    }
    [data-theme="dark"] .pane {
      background: rgba(58, 58, 58, 0.7);
      border-color: rgba(0, 102, 102, 0.3);
    }
    .pane::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 102, 0, 0.3), transparent);
    }
    label {
      display: block;
      color: var(--deep-teal);
      font-size: 0.9rem;
      margin-bottom: 8px;
      font-weight: 500;
      transition: var(--transition);
    }
    [data-theme="dark"] label {
      color: #80d0d0;
    }
    textarea, select, input[type="text"] {
      width: 100%;
      background: var(--soft-silver);
      border: 1px solid rgba(0, 77, 77, 0.2);
      color: var(--charcoal);
      padding: 12px 16px;
      border-radius: 10px;
      outline: none;
      font-family: inherit;
      font-size: 0.95rem;
      transition: var(--transition);
    }
    [data-theme="dark"] textarea, [data-theme="dark"] select, [data-theme="dark"] input[type="text"] {
      background: #3a3a3a;
      border-color: #555;
      color: #e0e0e0;
    }
    textarea:focus, select:focus, input[type="text"]:focus {
      border-color: var(--deep-teal);
      box-shadow: 0 0 0 3px rgba(0, 77, 77, 0.1);
      background: white;
    }
    [data-theme="dark"] textarea:focus, [data-theme="dark"] select:focus, [data-theme="dark"] input[type="text"]:focus {
      background: #4a4a4a;
      box-shadow: 0 0 0 3px rgba(0, 102, 102, 0.3);
    }
    textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.6;
    }
    .grid {
      display: grid;
      gap: 16px;
    }
    .two {
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 640px) {
      .two {
        grid-template-columns: 1fr;
      }
    }
    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    .btn {
      appearance: none;
      background: rgba(0, 77, 77, 0.05);
      border: 1px solid rgba(0, 77, 77, 0.2);
      color: var(--charcoal);
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    [data-theme="dark"] .btn {
      background: rgba(0, 102, 102, 0.1);
      border-color: rgba(0, 102, 102, 0.3);
      color: #e0e0e0;
    }
    .btn:hover {
      transform: translateY(-1px);
      border-color: rgba(0, 77, 77, 0.4);
      background: rgba(0, 77, 77, 0.1);
    }
    [data-theme="dark"] .btn:hover {
      border-color: rgba(0, 102, 102, 0.5);
      background: rgba(0, 102, 102, 0.2);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn.brand {
      background: linear-gradient(180deg, var(--deep-teal), #003737);
      border-color: var(--deep-teal);
      color: white;
    }
    .btn.accent {
      background: linear-gradient(180deg, var(--burnt-orange), var(--burnt-orange-hover));
      border-color: var(--burnt-orange);
      color: white;
    }
    .btn.ghost {
      background: transparent;
      border-color: transparent;
    }
    .meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0, 77, 77, 0.2);
      color: var(--deep-teal);
      font-size: 0.85rem;
      background: rgba(0, 77, 77, 0.05);
      transition: var(--transition);
    }
    [data-theme="dark"] .pill {
      border-color: rgba(0, 102, 102, 0.3);
      color: #80d0d0;
      background: rgba(0, 102, 102, 0.1);
    }
    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: rgba(0, 77, 77, 0.05);
      border: 1px solid rgba(0, 77, 77, 0.2);
      border-bottom-width: 2px;
      padding: 3px 6px;
      border-radius: 6px;
      font-size: 0.85rem;
      transition: var(--transition);
    }
    [data-theme="dark"] .kbd {
      background: rgba(0, 102, 102, 0.1);
      border-color: rgba(0, 102, 102, 0.3);
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
    }
    th, td {
      padding: 12px 16px;
      text-align: left;
      vertical-align: top;
    }
    thead th {
      color: var(--deep-teal);
      font-weight: 600;
      font-size: 0.9rem;
      background: rgba(0, 77, 77, 0.05);
      position: sticky;
      top: 0;
      transition: var(--transition);
    }
    [data-theme="dark"] thead th {
      color: #80d0d0;
      background: rgba(0, 102, 102, 0.1);
    }
    tbody tr {
      background: rgba(0, 77, 77, 0.03);
      border: 1px solid rgba(0, 77, 77, 0.1);
      transition: var(--transition);
    }
    [data-theme="dark"] tbody tr {
      background: rgba(0, 102, 102, 0.05);
      border-color: rgba(0, 102, 102, 0.2);
    }
    tbody tr:hover {
      background: rgba(0, 77, 77, 0.08);
    }
    [data-theme="dark"] tbody tr:hover {
      background: rgba(0, 102, 102, 0.1);
    }
    tbody td:first-child,
    thead th:first-child {
      border-top-left-radius: 10px;
      border-bottom-left-radius: 10px;
    }
    tbody td:last-child,
    thead th:last-child {
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
    }
    .remark {
      width: 100%;
      background: var(--soft-silver);
      border: 1px solid rgba(0, 77, 77, 0.2);
      color: var(--charcoal);
      padding: 10px 12px;
      border-radius: 8px;
      font-family: inherit;
      transition: var(--transition);
    }
    [data-theme="dark"] .remark {
      background: #3a3a3a;
      border-color: #555;
      color: #e0e0e0;
    }
    .remark:focus {
      border-color: var(--deep-teal);
      box-shadow: 0 0 0 2px rgba(0, 77, 77, 0.1);
    }
    [data-theme="dark"] .remark:focus {
      box-shadow: 0 0 0 2px rgba(0, 102, 102, 0.3);
    }
    /* Updated Footer Styles - Matching the main page */
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 1rem;
      border-top: 1px solid rgba(0, 77, 77, 0.1);
      color: var(--charcoal);
      font-size: 0.9rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    [data-theme="dark"] .footer {
      border-top-color: rgba(0, 102, 102, 0.3);
      color: #e0e0e0;
    }

    .footer-left {
      display: flex;
      gap: 1.5rem;
    }

    .version {
      color: var(--deep-teal);
      font-weight: 600;
    }

    [data-theme="dark"] .version {
      color: #80d0d0;
    }

    .footer-right {
      color: var(--deep-teal);
    }

    [data-theme="dark"] .footer-right {
      color: #80d0d0;
    }

    .heart {
      color: #ff6b6b;
    }
    /* End of Updated Footer Styles */

    .muted {
      color: var(--deep-teal);
      font-size: 0.86rem;
      transition: var(--transition);
    }
    [data-theme="dark"] .muted {
      color: #80d0d0;
    }
    .hidden {
      display: none;
    }
    .toast {
      position: fixed;
      right: 24px;
      bottom: 24px;
      padding: 12px 18px;
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid var(--success);
      color: #065f46;
      border-radius: 10px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 100;
      transform: translateY(20px);
      opacity: 0;
      transition: var(--transition);
    }
    .toast.visible {
      transform: translateY(0);
      opacity: 1;
    }
    .toast::before {
      content: "‚úì";
      font-weight: bold;
    }
    /* Search styles */
    .search-container {
      position: relative;
      margin-bottom: 16px;
    }
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--deep-teal);
      pointer-events: none;
      transition: var(--transition);
    }
    [data-theme="dark"] .search-icon {
      color: #80d0d0;
    }
    #searchSteps {
      padding-left: 44px;
      background-color: var(--soft-silver);
      border: 1px solid rgba(0, 77, 77, 0.2);
      color: var(--charcoal);
      width: 100%;
      padding: 12px 16px 12px 44px;
      border-radius: 10px;
      outline: none;
      transition: var(--transition);
    }
    [data-theme="dark"] #searchSteps {
      background-color: #3a3a3a;
      border-color: #555;
      color: #e0e0e0;
    }
    .no-results {
      text-align: center;
      padding: 24px;
      color: var(--deep-teal);
      font-style: italic;
      transition: var(--transition);
    }
    [data-theme="dark"] .no-results {
      color: #80d0d0;
    }
    .highlight {
      background-color: rgba(255, 102, 0, 0.3);
      border-radius: 2px;
      padding: 0 2px;
    }
    /* Category selector */
    .category-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 16px 0;
    }
    .category-tag {
      padding: 8px 14px;
      border-radius: 10px;
      background: rgba(0, 77, 77, 0.05);
      border: 1px solid rgba(0, 77, 77, 0.2);
      font-size: 0.85rem;
      cursor: pointer;
      transition: var(--transition);
    }
    [data-theme="dark"] .category-tag {
      background: rgba(0, 102, 102, 0.1);
      border-color: rgba(0, 102, 102, 0.3);
    }
    .category-tag:hover {
      background: rgba(255, 102, 0, 0.1);
      border-color: var(--burnt-orange);
    }
    .category-tag.active {
      background: var(--burnt-orange);
      border-color: var(--burnt-orange);
      color: white;
      font-weight: 500;
    }
    /* Table improvements */
    tbody tr.highlighted {
      background: rgba(255, 102, 0, 0.1);
      border-color: var(--burnt-orange);
    }
    /* Step counter */
    .step-counter {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
    }
    .step-counter span {
      color: var(--deep-teal);
      font-weight: 600;
      transition: var(--transition);
    }
    [data-theme="dark"] .step-counter span {
      color: #80d0d0;
    }
    /* Warning message */
    .warning-message {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: #92400e;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 0.9rem;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      animation: fadeIn 0.3s ease-out;
      transition: var(--transition);
    }
    [data-theme="dark"] .warning-message {
      color: #fde68a;
    }
    .warning-message::before {
      content: "‚ö†Ô∏è";
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Modern scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(0, 77, 77, 0.05);
    }
    [data-theme="dark"] ::-webkit-scrollbar-track {
      background: rgba(0, 102, 102, 0.1);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(0, 77, 77, 0.2);
      border-radius: 4px;
    }
    [data-theme="dark"] ::-webkit-scrollbar-thumb {
      background: rgba(0, 102, 102, 0.3);
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 77, 77, 0.4);
    }
    [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 102, 102, 0.5);
    }
    /* Loading animation */
    .loader {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(0, 77, 77, 0.3);
      border-radius: 50%;
      border-top-color: var(--deep-teal);
      animation: spin 1s ease-in-out infinite;
    }
    [data-theme="dark"] .loader {
      border-color: rgba(0, 102, 102, 0.3);
      border-top-color: #80d0d0;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="shell">
      <div class="header">
        <div class="header-left">
          <!-- Home button on left side -->
          <a href="index.html" class="home-button">
            <i class="fas fa-home"></i>
          </a>
          <!-- RepairAssist button -->
          <div class="repairassist-button">
            <i class="fas fa-screwdriver-wrench"></i>
          </div>
          <div class="title">
            RepairAssist
          </div>
        </div>
        <div class="header-right">
          <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i> Toggle Theme
          </button>
        </div>
      </div>

      <div class="row">
        <!-- LEFT: Input -->
        <div class="pane">
          <label for="issue">Describe the hardware issue</label>
          <textarea id="issue" placeholder="Example: 'Laptop not turning on' or 'Display flickering issues'..."></textarea>

          <div class="grid two">
            <div>
              <label for="category">Issue category</label>
              <select id="category"></select>
            </div>
            <div>
              <label for="part">Suggested component</label>
              <input id="part" type="text" placeholder="eg Motherboard / Battery / Adapter"/>
            </div>
          </div>

          <div id="warningMessage" class="warning-message hidden"></div>

          <div class="controls">
            <button class="btn accent" id="detectBtn">
              <span id="detectBtnText">Auto-detect</span>
              <span id="detectLoader" class="loader hidden"></span>
            </button>
            <button class="btn" id="loadStepsBtn">Load steps</button>
            <button class="btn ghost" id="clearBtn">Clear all</button>
          </div>
          
          <div class="category-selector" id="quickCategories">
            <!-- Quick categories will be inserted here by JS -->
          </div>
          
          <p class="muted">Pro tip: Press <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> to auto-detect & load steps</p>
        </div>

        <!-- RIGHT: Steps -->
        <div class="pane">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:16px">
            <h3 id="stepsTitle" style="margin:0">Troubleshooting Protocol</h3>
            <div class="meta">
              <div class="step-counter">
                <span id="visibleStepsCount">0</span> of <span id="totalStepsCount">0</span> steps
              </div>
            </div>
          </div>

          <div class="search-container">
            <div class="search-icon">üîç</div>
            <input type="text" id="searchSteps" placeholder="Search troubleshooting steps...">
          </div>

          <div id="tableWrap">
            <table>
              <thead>
                <tr>
                  <th style="width:48px">Step</th>
                  <th>Procedure</th>
                  <th style="width:46%">Technician Notes</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <!-- Updated Footer matching the main page -->
          <div class="footer">
            <div class="footer-left">
              <div class="version">¬© Reliance Industries Limited</div>
            </div>
            <div class="footer-right">Built with <span class="heart">‚ù§Ô∏è</span> for Efficiency</div>
            <div class="controls">
              <button class="btn brand" id="copyBtn">Copy Steps</button>
              <button class="btn" id="copySummaryBtn">Generate Summary</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="toast" class="toast">Copied to clipboard</div>
  </div>

<script>
/* ---------------------- DATASET: Categories & Steps ---------------------- */
const CATALOG = [
  { key:'no_power', title:'No POST / No Power', suggestedPart:'Motherboard',
    keywords:['no power','not turning on','no post','dead','won\'t turn on','power led off','no boot','no response'],
    steps:[
      'Remove the adapter and press the power button for 30 seconds (flea power reset)',
      'Test with a known-good adapter',
      'Check Caps/Num Lock LEDs ‚Äì do any LEDs glow',
      'Listen for fan spin at power-on',
      'Check if any beep codes are heard',
      'Test with an external monitor to rule out a display-only issue',
      'Test the faulty machine\'s adapter on a different laptop',
      'Connect a USB mouse/USB device and check if any LED glows',
      'Confirm if any LED is glowing near the power button or charging port',
      'Attach a clear laptop serial-number photo'
    ]
  },
  { key:'charging', title:'Charging Issues', suggestedPart:'Power Adapter / Charger',
    keywords:['not charging','charging issue','adapter not working','charger problem','battery not charging','power not charging'],
    steps:[
      'Test with a different charger',
      'Test the faulty charger on a different laptop',
      'Test the faulty charger\'s cable with a different adapter',
      'Test a different charger\'s cable with the faulty adapter',
      'Share the adapter barcode and complete details',
      'Attach a clear adapter label photo and the laptop serial-number photo'
    ]
  },
  { key:'keyboard', title:'Keyboard Issues', suggestedPart:'Keypad',
    keywords:['keyboard','keypad','keys not working','some keys','typing issue','key stuck','keys missing'],
    steps:[
      'Test with an external USB keyboard',
      'Test using the on-screen keyboard',
      'Test in BIOS setup',
      'Test in Safe Mode or Command Prompt',
      'Confirm if any keycaps are popped out (attach a photo if yes)',
      'Confirm which keys are not working',
      'Attach keyboard photos with all four corners visible',
      'Attach a clear laptop serial-number photo'
    ]
  },
  { key:'heating', title:'Overheating', suggestedPart:'Cooling FAN / Thermal Paste',
    keywords:['heating','overheating','hot','high temperature','temp','fan noise','thermal'],
    steps:[
      'Update Windows and all system drivers',
      'Update BIOS to the latest version',
      'Update the chipset drivers',
      'Update or reinstall the thermal driver (if applicable)',
      'Confirm if heating occurs with or without the adapter',
      'Check in BIOS setup and confirm if heating persists there',
      'Check for any abnormal fan noise',
      'Attach updated BIOS/driver screenshots and the serial-number photo'
    ]
  },
  { key:'touchpad', title:'Touchpad Issues', suggestedPart:'Touchpad',
    keywords:['touchpad','trackpad','cursor not moving','clicks not working','pointer issue','touchpad not responding'],
    steps:[
      'Test with a USB mouse',
      'Test in Safe Mode',
      'Update BIOS to the latest version',
      'Enable the touchpad from BIOS (if disabled)',
      'Uninstall the touchpad driver from Device Manager, restart, and test',
      'Install/update the latest touchpad driver',
      'Confirm whether the entire touchpad fails or only clicks are not working',
      'Attach touchpad driver version, updated BIOS version, touchpad photo, and laptop serial-number photo'
    ]
  },
  { key:'display', title:'Display Issues', suggestedPart:'Screen / LCD Cable',
    keywords:['display','screen','lines','flicker','no display','lcd','screen issue','flickering'],
    steps:[
      'Test with an external monitor',
      'Test in Safe Mode',
      'Test in BIOS setup',
      'Move the LCD lid and check if flickering occurs with movement',
      'Confirm whether flickering is continuous or intermittent',
      'Update BIOS to the latest version',
      'Update display/graphics drivers',
      'Share a short video of flickering in BIOS mode',
      'Attach updated display driver screenshot, updated BIOS version, display photo, and serial-number photo'
    ]
  },
  { key:'usb', title:'USB Port Issues', suggestedPart:'USB Port / Daughter Board / Motherboard',
    keywords:['usb port','pendrive not detecting','usb not working','type-a','usb device','external device'],
    steps:[
      'Update BIOS to the latest version',
      'Update the chipset drivers',
      'In Device Manager ‚Üí Universal Serial Bus controllers, uninstall USB Root Hub and test',
      'Test in Safe Mode',
      'Check in BIOS and ensure USB is enabled',
      'Test with a bootable USB drive',
      'Check if any device LEDs glow when connected to the USB ports',
      'Confirm which USB port(s) are not working',
      'Attach updated USB/chipset driver screenshots, updated BIOS screenshot, USB port photo, and serial-number photo'
    ]
  },
  { key:'camera', title:'Camera Issues', suggestedPart:'Web Camera',
    keywords:['camera','webcam','video not working','webcamera','video call','zoom camera'],
    steps:[
      'Update BIOS to the latest version',
      'Update the camera driver (mention the updated version)',
      'Enable the camera in BIOS (share the BIOS setting if applicable)',
      'Enable from Lenovo Vantage (if Lenovo)',
      'Test using an online camera test and confirm if it works',
      'Confirm if the microphone works',
      'Enable from Device Manager (privacy/settings)',
      'Reinstall the camera driver and test',
      'Attach updated camera driver screenshot, updated BIOS screenshot, any camera error code, camera photo, and serial-number photo'
    ]
  },
  { key:'mic', title:'Microphone Issues', suggestedPart:'Microphone',
    keywords:['mic','microphone not working','no input','audio input','voice not recording'],
    steps:[
      'Update BIOS to the latest version',
      'Confirm the microphone is not muted',
      'Update/reinstall the audio driver',
      'Enable the microphone in BIOS (if applicable)',
      'Check Windows audio settings (input device, levels, privacy)',
      'Check if the camera works (some privacy apps link mic & cam)',
      'Test with a different headset microphone',
      'If Lenovo, check Lenovo Vantage settings',
      'Share versions of the updated BIOS and audio driver',
      'Attach updated audio driver screenshot, updated BIOS version, microphone array (webcam area) photo, and serial-number photo'
    ]
  },
  { key:'audiojack', title:'Audio Jack Issues', suggestedPart:'Audio Jack / Daughter Board / Motherboard',
    keywords:['audio jack','headphone jack','3.5mm','earphone not working','headphones not working','audio port'],
    steps:[
      'Update BIOS to the latest version',
      'Update/reinstall the audio driver',
      'Enable the audio device from BIOS (if disabled)',
      'Reinstall the driver from Device Manager',
      'Test with a different headphone',
      'Confirm if the internal speakers work',
      'Test in Safe Mode',
      'Attach updated audio driver screenshot, updated BIOS screenshot, and serial-number photo'
    ]
  },
  { key:'fingerprint', title:'Fingerprint Issues', suggestedPart:'Fingerprint Sensor',
    keywords:['fingerprint','biometric','windows hello','fingerprint not working'],
    steps:[
      'Update BIOS to the latest version',
      'Update the fingerprint driver',
      'Enable fingerprint in BIOS',
      'Check/adjust Windows Hello settings',
      'Reinstall the fingerprint driver via Device Manager',
      'Test in Safe Mode',
      'Attach updated fingerprint driver screenshot, updated BIOS version, and serial-number photo'
    ]
  },
  { key:'battery_backup', title:'Battery Issues', suggestedPart:'Battery',
    keywords:['battery backup','battery drains fast','low backup','battery issue','power drain','battery life'],
    steps:[
      'Test with a different adapter',
      'Test the faulty machine\'s adapter on a different laptop',
      'Share a current battery snapshot',
      'Generate and share the Windows battery report',
      'Attach the battery test report',
      'If the battery test passes, charge to 100% and share timestamped screenshots at 100%, 75%, 50%, and 25%',
      'Note: If backup is less than 1.5 hours, proceed with battery replacement',
      'Attach the battery test report, Windows battery report, any calibration test screenshots, and the serial-number photo'
    ]
  },
  { key:'ethernet', title:'Ethernet Issues', suggestedPart:'Daughter Board / Motherboard',
    keywords:['ethernet','lan','rj45','wired network','internet cable','network port'],
    steps:[
      'Check the network icon status in the system tray (Normal / Limited access / Disconnected)',
      'In BIOS ‚Üí Security ‚Üí I/O Port Access, ensure Ethernet is enabled',
      'Check for physical damage to the RJ-45 port',
      'Check whether LAN LEDs are blinking',
      'Test with a known-good cable and confirm status',
      'In Device Manager, if the NIC is detected, uninstall drivers, restart, and reinstall Is LAN working',
      'Update the network driver and BIOS',
      'Check if other devices work on the same LAN/router/switch',
      'Share versions of the updated BIOS and LAN driver',
      'Test the faulty machine\'s LAN with a different machine/cable and confirm',
      'Attach updated Ethernet driver version, updated BIOS version, and serial-number photo'
    ]
  },
  { key:'wifi', title:'Wi-Fi Issues', suggestedPart:'Wi-Fi Card',
    keywords:['wifi','wi-fi','wireless','no wifi','wlan','wireless network'],
    steps:[
      'Enable the wireless device in Device Manager',
      'Remove the Wi-Fi driver via Device Manager',
      'Install/update the latest Wi-Fi driver',
      'Update BIOS to the latest version',
      'If Lenovo, ensure Wi-Fi is enabled in BIOS',
      'Test with a different Wi-Fi network / mobile hotspot',
      'Test in Safe Mode',
      'Attach updated Wi-Fi driver screenshot, updated BIOS version, and serial-number photo'
    ]
  },
  { key:'speaker', title:'Speaker Issues', suggestedPart:'Speaker',
    keywords:['speaker not working','no sound speaker','audio output','no sound','speaker mute'],
    steps:[
      'Restart the system and press Esc/Enter repeatedly; confirm if any BIOS beep/sound is heard',
      'Confirm if sound is audible through earphones/external headphones',
      'Update/reinstall the audio driver',
      'Update BIOS to the latest version',
      'Confirm there is no physical damage or liquid spillage to the speakers/system',
      'Attach updated audio driver screenshot, updated BIOS version, and serial-number photo'
    ]
  },
  { key:'dc_port', title:'DC Port Issues', suggestedPart:'DC Port / Motherboard',
    keywords:['dc port','power jack','loose charging','dc in','charging port','power connector'],
    steps:[
      'Test with a different charger',
      'Confirm the same charger works with another laptop',
      'If available, test charging via USB-C (if supported)',
      'Update BIOS to the latest version',
      'Update chipset drivers',
      'Attach photos of the charger tip and the DC port'
    ]
  },
  { key:'damage', title:'Physical Damage', suggestedPart:'Parts depends on the damage',
    keywords:['damage','crack','broken','liquid','accidental','dent','physical damage'],
    steps:[
      'Attach clear photos of the damaged part(s)',
      'Attach the laptop serial-number photo',
      'Attach the Accidental Damage (ADP) form, if applicable'
    ]
  },
  { key:'hdmi', title:'HDMI Issues', suggestedPart:'Daughter Board / Motherboard',
    keywords:['hdmi','external display','projector','windows+p','duplicate','extend','second monitor'],
    steps:[
      'Update the graphics driver to the latest version',
      'Update BIOS to the latest version',
      'Press Windows + P and set the projection mode to Duplicate or Extend',
      'Test with a different external screen / or test the same screen with a different laptop',
      'Attach updated graphics driver screenshot, updated BIOS version, and serial-number photo'
    ]
  }
];

/* ---------------------- UI Elements ---------------------- */
const sel = (q)=>document.querySelector(q);
const categorySel = sel('#category');
const issueEl = sel('#issue');
const partEl = sel('#part');
const tbody = sel('#tbody');
const toastEl = sel('#toast');
const searchInput = sel('#searchSteps');
const quickCategories = sel('#quickCategories');
const visibleStepsCount = sel('#visibleStepsCount');
const totalStepsCount = sel('#totalStepsCount');
const warningMessage = sel('#warningMessage');
const detectBtnText = sel('#detectBtnText');
const detectLoader = sel('#detectLoader');
const themeToggle = sel('#themeToggle');

/* Theme toggle functionality */
function toggleTheme() {
  const isDark = document.body.dataset.theme === 'dark';
  document.body.dataset.theme = isDark ? 'light' : 'dark';
  const icon = themeToggle.querySelector('i');
  const text = themeToggle.querySelector('span');
  icon.className = isDark ? 'fas fa-moon' : 'fas fa-sun';
  if (text) text.textContent = isDark ? ' Dark Mode' : ' Light Mode';
  localStorage.setItem('theme', isDark ? 'light' : 'dark');
}

// Load saved theme
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'dark') {
  document.body.dataset.theme = 'dark';
  themeToggle.querySelector('i').className = 'fas fa-sun';
}

themeToggle.addEventListener('click', toggleTheme);

/* Build dropdown */
CATALOG.forEach(c=>{
  const opt=document.createElement('option');
  opt.value=c.key; opt.textContent=c.title; categorySel.appendChild(opt);
});

/* Create quick category buttons */
function createQuickCategories() {
  const popularCategories = [
    'no_power', 'charging', 'keyboard', 'display', 'heating', 'touchpad'
  ];
  
  popularCategories.forEach(key => {
    const cat = CATALOG.find(c => c.key === key);
    if (cat) {
      const btn = document.createElement('div');
      btn.className = 'category-tag';
      btn.textContent = cat.title;
      btn.dataset.key = cat.key;
      btn.addEventListener('click', () => {
        categorySel.value = cat.key;
        partEl.value = cat.suggestedPart || '';
        loadSteps();
        // Highlight the selected category
        document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        // Clear any warnings
        warningMessage.classList.add('hidden');
      });
      quickCategories.appendChild(btn);
    }
  });
}

/* Show warning about keyword matching */
function showKeywordWarning(inputText, bestMatch) {
  const inputWords = inputText.toLowerCase().split(/\s+/);
  const matchKeywords = bestMatch.keywords;
  
  // Find words that didn't match any keywords
  const unmatchedWords = inputWords.filter(word => 
    word.length > 3 && !matchKeywords.some(kw => kw.includes(word))
  );
  
  if (unmatchedWords.length > 0) {
    warningMessage.innerHTML = `
      The keyword(s) <strong>${unmatchedWords.slice(0, 3).join(', ')}</strong> 
      didn't match our database Try using: <strong>${matchKeywords.slice(0, 3).join(', ')}</strong>
    `;
    warningMessage.classList.remove('hidden');
  } else {
    warningMessage.classList.add('hidden');
  }
}

/* Detect category by keywords */
function detect(){
  const text = (issueEl.value||'').toLowerCase().trim();
  if (!text) return;
  
  detectBtnText.textContent = 'Detecting...';
  detectLoader.classList.remove('hidden');
  
  // Simulate slight delay for better UX
  setTimeout(() => {
    let best = null, score = -1;
    for(const c of CATALOG){
      let s = 0; 
      for(const k of c.keywords){ 
        if(text.includes(k)) s++; 
      }
      if(s > score){ score = s; best = c; }
    }
    
    if (best && score > 0) {
      categorySel.value = best.key;
      partEl.value = best.suggestedPart || '';
      showKeywordWarning(text, best);
      
      // Highlight the matching quick category if any
      document.querySelectorAll('.category-tag').forEach(t => {
        t.classList.toggle('active', t.dataset.key === best.key);
      });
    } else {
      // No match found
      warningMessage.innerHTML = `
        No matching issue found Please select a category manually or try different keywords
        Common issues: no power, display issues, keyboard not working
      `;
      warningMessage.classList.remove('hidden');
    }
    
    detectBtnText.textContent = 'Auto-detect';
    detectLoader.classList.add('hidden');
  }, 500);
}

/* Highlight search terms in text */
function highlightText(text, searchTerm) {
  if (!searchTerm) return text;
  
  const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
  return text.replace(regex, '<span class="highlight">$1</span>');
}

/* Filter steps based on search */
function filterSteps() {
  const searchTerm = searchInput.value.trim().toLowerCase();
  const rows = [...tbody.querySelectorAll('tr')];
  let visibleCount = 0;
  
  rows.forEach(row => {
    const stepText = row.children[1].textContent.toLowerCase();
    const isVisible = !searchTerm || stepText.includes(searchTerm);
    
    if (isVisible) {
      row.style.display = '';
      visibleCount++;
      
      // Highlight matching text
      if (searchTerm) {
        row.children[1].innerHTML = highlightText(row.children[1].textContent, searchTerm);
        row.classList.add('highlighted');
      } else {
        row.children[1].textContent = row.children[1].textContent; // Reset to plain text
        row.classList.remove('highlighted');
      }
    } else {
      row.style.display = 'none';
    }
  });
  
  // Update counter
  visibleStepsCount.textContent = visibleCount;
}

/* Load steps for selected category */
function loadSteps() {
  const key = categorySel.value;
  const cat = CATALOG.find(c => c.key === key);
  if (!cat) return;
  
  tbody.innerHTML = '';
  cat.steps.forEach((step, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${step}</td>
      <td><textarea class="remark" placeholder="Add technician notes..."></textarea></td>
    `;
    tbody.appendChild(tr);
  });

  totalStepsCount.textContent = cat.steps.length;
  filterSteps(); // refresh count & search highlighting
}

/* Copy full protocol + notes */
function copyProtocol() {
  const key = categorySel.value;
  const cat = CATALOG.find(c => c.key === key);
  if (!cat) return;

  let text = `Issue: ${issueEl.value}\n\nTroubleshooting Steps:\n`;
  [...tbody.querySelectorAll('tr')].forEach((row, i) => {
    const step = row.children[1].textContent;
    const note = row.querySelector('textarea').value.trim();
    text += `${i + 1}. ${step}`;
    if (note) text += `: ${note}`;
    text += `\n`;
  });

  navigator.clipboard.writeText(text).then(() => showToast());
}

/* Copy summary only */
function copySummary() {
  const key = categorySel.value;
  const cat = CATALOG.find(c => c.key === key);
  if (!cat) return;

  const summary = `Issue: ${issueEl.value}\nCategory: ${cat.title}\nSuggested Part: ${partEl.value}`;
  navigator.clipboard.writeText(summary).then(() => showToast());
}

/* Show toast */
function showToast() {
  toastEl.classList.add('visible');
  setTimeout(() => toastEl.classList.remove('visible'), 2000);
}

/* Clear all fields */
function clearAll() {
  issueEl.value = '';
  partEl.value = '';
  categorySel.value = '';
  tbody.innerHTML = '';
  visibleStepsCount.textContent = 0;
  totalStepsCount.textContent = 0;
  document.querySelectorAll('.category-tag').forEach(t => t.classList.remove('active'));
  warningMessage.classList.add('hidden');
}

/* ---------------------- Event Listeners ---------------------- */
sel('#detectBtn').addEventListener('click', detect);
sel('#loadStepsBtn').addEventListener('click', loadSteps);
sel('#copyBtn').addEventListener('click', copyProtocol);
sel('#copySummaryBtn').addEventListener('click', copySummary);
sel('#clearBtn').addEventListener('click', clearAll);
searchInput.addEventListener('input', filterSteps);
issueEl.addEventListener('keydown', e => {
  if (e.ctrlKey && e.key === 'Enter') {
    detect();
    setTimeout(loadSteps, 600);
  }
});

/* Init quick categories */
createQuickCategories();
</script>
</body>
</html>